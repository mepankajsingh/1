---
interface Props {
  library: {
    id: string;
    name: string;
    slug: string;
    description: string;
    icon_url?: string;
    logo_url?: string;
    github_stars?: number;
    npm_downloads?: number;
    npm_package_name?: string;
    framework?: {
      name: string;
      slug: string;
    };
    tags?: {
      tag_id: {
        name: string;
        slug: string;
      };
    }[];
  };
}

const { library } = Astro.props;
const imageUrl = library.icon_url || library.logo_url || '/favicon.svg';

// Format numbers for display
function formatNumber(num: number): string {
  if (!num) return '0';
  if (num >= 1000000) {
    return (num / 1000000).toFixed(1) + 'M';
  }
  if (num >= 1000) {
    return (num / 1000).toFixed(1) + 'k';
  }
  return num.toString();
}

// Get tags (limit to 2 for display)
const tags = library.tags ? library.tags.slice(0, 2).map(t => t.tag_id) : [];
---

<a href={`/libraries/${library.slug}`} class="block group">
  <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow duration-200">
    <div class="flex items-start">
      <div class="w-10 h-10 flex-shrink-0 flex items-center justify-center mr-3">
        <img 
          src={imageUrl} 
          alt={`${library.name} logo`} 
          class="max-w-full max-h-full object-contain"
          onerror="this.onerror=null; this.src='/favicon.svg';"
        />
      </div>
      <div class="flex-1 min-w-0">
        <h3 class="text-sm font-medium text-gray-900 group-hover:text-indigo-600 truncate">
          {library.name}
        </h3>
        {library.framework && (
          <p class="text-xs text-gray-500 truncate">
            {library.framework.name}
          </p>
        )}
      </div>
      {library.github_stars && (
        <div class="flex items-center text-gray-700 text-xs">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z"/>
          </svg>
          {formatNumber(library.github_stars)}
        </div>
      )}
    </div>
    
    <p class="mt-2 text-xs text-gray-600 line-clamp-2">
      {library.description}
    </p>
    
    {tags.length > 0 && (
      <div class="mt-3 flex flex-wrap gap-1">
        {tags.map(tag => (
          <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-indigo-50 text-indigo-700">
            {tag.name}
          </span>
        ))}
      </div>
    )}
  </div>
</a>
