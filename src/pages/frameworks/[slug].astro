---
import Layout from '../../layouts/Layout.astro';
import LibraryCard from '../../components/LibraryCard.astro';
import { supabase } from '../../lib/supabase';

export const prerender = false;

const { slug } = Astro.params;

// Get framework details
const { data: framework, error: frameworkError } = await supabase
  .from('frameworks')
  .select('*')
  .eq('slug', slug)
  .single();

// Handle 404
if (frameworkError && frameworkError.code === 'PGRST116') {
  return Astro.redirect('/404');
}

// Get libraries for this framework
const { data: libraries, error: librariesError } = await supabase
  .from('libraries')
  .select(`
    *,
    framework:framework_id(id, name, slug),
    tags:library_tags(tag_id(id, name, slug))
  `)
  .eq('framework_id', framework?.id || 0)
  .order('github_stars', { ascending: false });
---

<Layout title={framework ? `${framework.name} UI Libraries - UI Library Directory` : 'Loading...'}>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    {framework && (
      <div class="mb-8 flex items-center gap-4">
        {framework.icon_url && (
          <img 
            src={framework.icon_url} 
            alt={`${framework.name} logo`} 
            class="w-12 h-12 object-contain"
          />
        )}
        <div>
          <h1 class="text-3xl font-bold text-gray-900 mb-1">{framework.name} Libraries</h1>
          <p class="text-lg text-gray-600">
            Component libraries and UI kits for {framework.name}
          </p>
        </div>
      </div>
    )}

    {libraries && (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {libraries.map(library => (
          <LibraryCard library={library} />
        ))}
        
        {libraries.length === 0 && (
          <div class="col-span-3 py-12 text-center">
            <h3 class="text-lg font-medium text-gray-900 mb-1">No libraries found</h3>
            <p class="text-gray-500">
              We don't have any libraries for this framework yet.
            </p>
          </div>
        )}
      </div>
    )}
  </main>
</Layout>
