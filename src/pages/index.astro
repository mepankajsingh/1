---
import Layout from '../layouts/Layout.astro';
import Card from '../components/Card.astro';
import FrameworkCard from '../components/FrameworkCard.astro';
import LibraryCard from '../components/LibraryCard.astro';
import SearchBar from '../components/SearchBar.jsx';
import { supabase } from '../lib/supabase';

// Get frameworks
const { data: frameworks } = await supabase
  .from('frameworks')
  .select('*')
  .order('name');

// Get popular libraries
const { data: popularLibraries } = await supabase
  .from('libraries')
  .select(`
    *,
    framework:framework_id(id, name, slug),
    tags:library_tags(tag_id(id, name, slug))
  `)
  .order('github_stars', { ascending: false })
  .limit(6);

// Get recent libraries
const { data: recentLibraries } = await supabase
  .from('libraries')
  .select(`
    *,
    framework:framework_id(id, name, slug),
    tags:library_tags(tag_id(id, name, slug))
  `)
  .order('created_at', { ascending: false })
  .limit(3);

// Get tags
const { data: tags } = await supabase
  .from('tags')
  .select('*')
  .order('name');
---

<Layout title="UI Library Directory - Find the Best JavaScript UI Libraries">
  <main>
    <!-- Hero Section -->
    <div class="bg-white border-b border-gray-100">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16">
        <div class="text-center">
          <h1 class="text-4xl font-bold text-gray-900 sm:text-5xl">
            Find the Perfect UI Library
          </h1>
          <p class="mt-3 max-w-2xl mx-auto text-xl text-gray-600 sm:mt-4">
            Discover and compare the best UI libraries and component kits for your next project
          </p>
          <div class="mt-8 max-w-xl mx-auto">
            <SearchBar client:load />
          </div>
        </div>
      </div>
    </div>

    <!-- Frameworks Section -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Frameworks</h2>
        <a href="/frameworks" class="text-indigo-600 hover:text-indigo-800 font-medium">
          View all
        </a>
      </div>
      
      {frameworks && (
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
          {frameworks.map(framework => (
            <FrameworkCard framework={framework} />
          ))}
        </div>
      )}
    </div>

    <!-- Popular Libraries Section -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 border-t border-gray-100">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Popular Libraries</h2>
        <a href="/libraries" class="text-indigo-600 hover:text-indigo-800 font-medium">
          View all
        </a>
      </div>
      
      {popularLibraries && (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {popularLibraries.map(library => (
            <LibraryCard library={library} />
          ))}
        </div>
      )}
    </div>

    <!-- Recent Libraries Section -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 border-t border-gray-100">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Recently Added</h2>
        <a href="/libraries" class="text-indigo-600 hover:text-indigo-800 font-medium">
          View all
        </a>
      </div>
      
      {recentLibraries && (
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          {recentLibraries.map(library => (
            <LibraryCard library={library} />
          ))}
        </div>
      )}
    </div>

    <!-- Tags Section -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 border-t border-gray-100">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Browse by Tag</h2>
        <a href="/tags" class="text-indigo-600 hover:text-indigo-800 font-medium">
          View all
        </a>
      </div>
      
      {tags && (
        <div class="flex flex-wrap gap-2">
          {tags.slice(0, 20).map(tag => (
            <a 
              href={`/tags/${tag.slug}`}
              class="inline-flex items-center px-3 py-1.5 rounded-md text-sm bg-gray-50 text-gray-700 hover:bg-gray-100 border border-gray-100"
            >
              {tag.name}
            </a>
          ))}
        </div>
      )}
    </div>
  </main>
</Layout>
